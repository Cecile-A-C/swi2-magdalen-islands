# swi2-magdalen-islands

Scripts and files for the MODFLOW-SWI2 model of the Grande-Entrée Island (Magdalen Islands, Quebec, Canada).

## 1) 'model' folder: To conduct parameter estimation using PEST
This folder contains all the files necessary to conduct parameter estimation using PEST-HP (Doherty, 2020):

- the PEST control file: *calreg_v16_pp_hp.pst*
- the main Python script controlling model run using FloPy & generating the .dat files in the **model_outputs** folder: *model_run_pest.py*
- the Python script containing functions used by *model_run_pest.py* to run the model: *functions_model_run.py*
- the binary file containing input information (e.g. ibound, sea, dem and geology grids; the row & col location of municipal wells and of all observations): *preproc_IDM_20m_qgis_v6.bin* (see http://github.com/apryet/Qgridder)
- the file containing the pilot point kriging factors (for hydraulic conductivity): *pp_30max.fac* (Note: Unzip the folder **pp_30max.zip**)

- the **model_files** folder: contains PEST observations & forecasts (*hwells_obs.csv*, *hdomest_obs.csv*, *zwells_obs.csv*, *ztdem_obs.csv*, *zert_obs.csv*, *FWstorage_obs.csv*), PEST parameters (*param.csv*), and information used for the MNW2 package (*muni_wells_mnw2_data.csv*)
- the **model_ouputs** folder: contains the simulated data (*hwells_sim.dat*, *hdomest_sim.dat*, *zwells_sim.dat*, *ztdem_sim.dat*, *zert_sim.dat*, *fw_storage_sim.dat*)
- the **pest_files** folder: contains PEST instruction (*hwells.ins*, *zwells.ins*, *ztdem.ins*, *zert.ins*, *fw_storage.ins*) and template files (*param.tpl*, *hk1pp.dat.tpl*)


## 2) 'pest_outputs' folder: To analyze PEST outputs and conduct linear analysis
This folder contains all the files necessary to analyze the outputs of parameter estimation and conduct linear analysis using PyEMU:

- the **parameter_estimation** folder: contains the files generated by parameter estimation using PEST-HP (*calreg_v16_pp_hp*.* files, intermediate files are not included). The best parameter set from this calibration is contained in *calreg_v16_pp_hp.par*
- the **linear_analysis_bpa** folder: contains the files generated for linear analysis. PEST's PARREP utility was used on *calreg_v16_pp_hp.pst*, with the best parameter set contained in *calreg_v16_pp_hp.par*, to create the *calreg_v16_pp_hp_la_bpa.pst* PEST control file. In this new .pst file, no log transformation was applied on recharge. PEST was then run with *calreg_v16_pp_hp_la_bpa.pst* and noptmax=-1
- the **model_run_priorcalib** folder: contains the files generated by the main Python script *model_run_plot.py* with the prior parameter set, before parameter estimation (reading parameters from *calreg_v16_pp_hp.pst* and *hk1pp_priorcalib.dat* files)
- the **model_run_bpa** folder: contains the files generated by the main Python script model_run_plot.py with the best parameter set, after parameter estimation (reading parameters from *calreg_v16_pp_hp.par* and *hk1pp_bpa.dat* files)


- the main Python script controlling model run using FloPy & generating Figures 6A and 6B: *model_run_plot.py*
- the main Python script conducting linear analysis, analyzing outputs of parameter estimation & linear analysis & generating Figures 5, 7-9 and A.1: *model_linear_analysis.py*

- the Python script containing functions used by *model_run_plot.py* to run the model: *functions_model_run.py*
- the Python script containing functions used by *model_run_plot.py* to plot Figures 6A and 6B: *functions_model_plot.py*
- the Python script containing functions used by *linear_analysis.py* to plot the Figures 5, 7-9 and A.1: *functions_linear_analysis.py*

- the binary file containing input information (e.g. ibound, sea, dem and geology grids; the row & col location of municipal wells and of all observations): *preproc_IDM_20m_qgis_v6.bin*
- the file containing the pilot point kriging factors (for hydraulic conductivity): *pp_30max.fac* (Note: Unzip the folder **pp_30max.zip**)
- the file containing information used for the MNW2 package: *muni_wells_mnw2_data.csv*

## 3) 'gis' folder
This folder contains all the shapefiles necessary to plot the results of parameter estimation & linear analysis


# References

Doherty, J., 2020. PEST_HP, PEST for highly parallelized computing environments. Watermark Numerical Computing. 

The Python scripts were developed using examples from:

- **The FloPy documentation** (http://github.com/modflowpy/flopy):

Bakker, Mark, Post, Vincent, Langevin, C. D., Hughes, J. D., White, J. T., Starn, J. J. and Fienen, M. N., 2016, Scripting MODFLOW Model Development Using Python and FloPy: Groundwater, v. 54, p. 733–739, doi:10.1111/gwat.12413.

Bakker, Mark, Post, Vincent, Langevin, C. D., Hughes, J. D., White, J. T., Leaf, A. T., Paulinski, S. R., Larsen, J. D., Toews, M. W., Morway, E. D., Bellino, J. C., Starn, J. J., and Fienen, M. N., 2020, FloPy v3.3.3 — release candidate: U.S. Geological Survey Software Release, 27 October 2020, http://dx.doi.org/10.5066/F7BK19FH

Especially 3 notebooks: *flopy3_swi2package_ex4.ipynb* (http://github.com/modflowpy/flopy/blob/7cb429f81a9206fa450cceff21c695faf01fce41/examples/Notebooks/flopy3_swi2package_ex1.ipynb), *flopy3_swi2package_ex4.ipynb* (http://github.com/modflowpy/flopy/blob/7cb429f81a9206fa450cceff21c695faf01fce41/examples/Notebooks/flopy3_swi2package_ex4.ipynb) and *flopy3_mnw2package_example* (http://github.com/modflowpy/flopy/blob/7cb429f81a9206fa450cceff21c695faf01fce41/examples/Notebooks/flopy3_mnw2package_example.ipynb)

- **The PyEMU documentation** (http://github.com/pypest/pyemu):

White, J. T., Fienen, M. N., & Doherty, J. E. (2016). A python framework for environmental model uncertainty analysis. Environmental Modelling & Software, 85, 217-228.

Especially 1 notebook: *Schurexample_freyberg.ipynb* (http://github.com/pypest/pyemu/blob/e6ce853cd8126b984e363186c4cd2c425cae4a1e/examples/Schurexample_freyberg.ipynb)

- **Jupyter notebooks developed by Christopher Shuler** (http://github.com/cshuler) :

Especially 2 notebooks: *Shuler_CEE696_FINAL_MODEL.ipynb* (http://github.com/cshuler/CEE-699-Final/blob/master/Shuler_final/Shuler_CEE696_FINAL_MODEL.ipynb) and *Tutuila_SWI_GHB_1_MOST_CURRENT.ipynb* (http://github.com/cshuler/ASPA-UH_Integrated_Modeling_Framework/blob/master/ASPA-UH-Flopy_REPO/Models/Tutuila_SWI_GHB/Tutuila_SWI_GHB_1_MOST_CURRENT.ipynb)

# Acknowledgments
Pierre Matran and Ryma Aissat are also thanked for their occasional help debugging the Python scripts.
